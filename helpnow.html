<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>HELP NOW - Live Demo Prototype</title>

    <style>

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

        }

        

        body {

            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;

            background: #0a0e1a;

            overflow: hidden;

            min-height: 100vh;

            position: relative;

        }

        

        /* 3D Control Room Background */

        .control-room-environment {

            position: fixed;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background: 

                radial-gradient(ellipse at top, #1a2744 0%, #0a0e1a 40%),

                linear-gradient(180deg, #0a0e1a 0%, #0f1420 100%);

            overflow: hidden;

            z-index: 0;

        }

        

        /* Ambient lighting effects */

        .ambient-lights {

            position: absolute;

            width: 100%;

            height: 100%;

            opacity: 0.3;

            background: 

                radial-gradient(circle at 20% 50%, rgba(0, 230, 118, 0.2) 0%, transparent 50%),

                radial-gradient(circle at 80% 30%, rgba(33, 150, 243, 0.15) 0%, transparent 40%),

                radial-gradient(circle at 60% 80%, rgba(244, 67, 54, 0.1) 0%, transparent 40%);

            animation: ambientPulse 8s ease-in-out infinite;

        }

        

        @keyframes ambientPulse {

            0%, 100% { opacity: 0.3; }

            50% { opacity: 0.5; }

        }

        

        /* Control room grid floor */

        .grid-floor {

            position: absolute;

            bottom: 0;

            left: -50%;

            width: 200%;

            height: 50%;

            background-image: 

                linear-gradient(rgba(0, 230, 118, 0.03) 1px, transparent 1px),

                linear-gradient(90deg, rgba(0, 230, 118, 0.03) 1px, transparent 1px);

            background-size: 100px 100px;

            transform: perspective(500px) rotateX(60deg);

            opacity: 0.6;

        }

        

        /* Data streams effect */

        .data-streams {

            position: absolute;

            width: 100%;

            height: 100%;

            opacity: 0.1;

        }

        

        .data-stream {

            position: absolute;

            width: 2px;

            background: linear-gradient(180deg, transparent, rgba(0, 230, 118, 0.8), transparent);

            animation: dataFlow 3s linear infinite;

        }

        

        .data-stream:nth-child(1) { left: 10%; height: 200px; animation-delay: 0s; }

        .data-stream:nth-child(2) { left: 25%; height: 150px; animation-delay: 0.5s; }

        .data-stream:nth-child(3) { left: 40%; height: 180px; animation-delay: 1s; }

        .data-stream:nth-child(4) { left: 60%; height: 160px; animation-delay: 1.5s; }

        .data-stream:nth-child(5) { left: 75%; height: 190px; animation-delay: 2s; }

        .data-stream:nth-child(6) { left: 90%; height: 170px; animation-delay: 2.5s; }

        

        @keyframes dataFlow {

            0% { transform: translateY(-200px); opacity: 0; }

            10% { opacity: 0.5; }

            90% { opacity: 0.5; }

            100% { transform: translateY(100vh); opacity: 0; }

        }

        

        /* Main container */

        .container {

            position: relative;

            z-index: 10;

            width: 100%;

            height: 100vh;

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            padding: 20px;

        }

        

        /* Header */

        .header {

            position: absolute;

            top: 40px;

            text-align: center;

            animation: slideDown 1s ease-out;

        }

        

        @keyframes slideDown {

            from {

                transform: translateY(-50px);

                opacity: 0;

            }

            to {

                transform: translateY(0);

                opacity: 1;

            }

        }

        

        h1 {

            font-size: 48px;

            font-weight: 800;

            background: linear-gradient(135deg, #00E676 0%, #00C853 50%, #2196F3 100%);

            -webkit-background-clip: text;

            -webkit-text-fill-color: transparent;

            background-clip: text;

            text-shadow: 0 0 40px rgba(0, 230, 118, 0.5);

            letter-spacing: -0.02em;

            margin-bottom: 10px;

        }

        

        .subtitle {

            font-size: 18px;

            color: rgba(255, 255, 255, 0.7);

            font-weight: 300;

            letter-spacing: 2px;

            text-transform: uppercase;

        }

        

        /* Main Interface Card */

        .interface-card {

            background: linear-gradient(135deg, 

                rgba(255, 255, 255, 0.1) 0%, 

                rgba(255, 255, 255, 0.05) 100%);

            backdrop-filter: blur(10px);

            border-radius: 24px;

            padding: 40px;

            border: 1px solid rgba(255, 255, 255, 0.1);

            box-shadow: 

                0 20px 60px rgba(0, 0, 0, 0.3),

                0 0 100px rgba(0, 230, 118, 0.1),

                inset 0 0 60px rgba(255, 255, 255, 0.05);

            max-width: 1200px;

            width: 100%;

            animation: floatInterface 6s ease-in-out infinite;

        }

        

        @keyframes floatInterface {

            0%, 100% {

                transform: translateY(0px);

            }

            50% {

                transform: translateY(-10px);

            }

        }

        

        /* Operator Interface */

        .operator-mockup {

            background: #f8f9fa;

            border: 2px solid rgba(255, 255, 255, 0.2);

            border-radius: 16px;

            overflow: hidden;

            box-shadow: 

                0 20px 60px rgba(0, 0, 0, 0.5),

                0 0 80px rgba(33, 150, 243, 0.1);

        }

        

        .operator-header {

            background: linear-gradient(90deg, #1e3a5f 0%, #2c4a70 100%);

            color: white;

            padding: 15px 20px;

            display: flex;

            justify-content: space-between;

            align-items: center;

            border-bottom: 2px solid rgba(0, 230, 118, 0.3);

        }

        

        .operator-title {

            font-size: 18px;

            font-weight: 600;

            letter-spacing: 0.5px;

        }

        

        .operator-main {

            padding: 30px;

            background: white;

            min-height: 500px;

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

        }

        

        /* State-based content */

        .state-content {

            width: 100%;

            text-align: center;

            animation: fadeIn 0.5s ease-out;

        }

        

        @keyframes fadeIn {

            from {

                opacity: 0;

                transform: translateY(20px);

            }

            to {

                opacity: 1;

                transform: translateY(0);

            }

        }

        

        /* Start button */

        .start-btn {

            background: linear-gradient(135deg, #00C853, #00E676);

            color: white;

            border: none;

            padding: 30px 60px;

            font-size: 24px;

            font-weight: 700;

            border-radius: 12px;

            cursor: pointer;

            transition: all 0.3s ease;

            box-shadow: 0 10px 30px rgba(0, 230, 118, 0.3);

        }

        

        .start-btn:hover {

            transform: translateY(-2px);

            box-shadow: 0 15px 40px rgba(0, 230, 118, 0.4);

        }

        

        /* Audio visualizer */

        .audio-visualizer {

            display: flex;

            justify-content: center;

            align-items: center;

            height: 100px;

            gap: 4px;

            margin: 30px 0;

        }

        

        .audio-bar {

            width: 6px;

            background: linear-gradient(to top, #00E676, #00C853);

            border-radius: 3px;

            transition: height 0.1s ease;

        }

        

        /* Language detection display */

        .detection-display {

            padding: 30px;

            background: linear-gradient(135deg, #f0f9ff, #ffffff);

            border-radius: 16px;

            margin: 20px 0;

            border: 2px solid rgba(33, 150, 243, 0.2);

        }

        

        .detected-language {

            font-size: 36px;

            font-weight: 700;

            color: #1976D2;

            margin-bottom: 10px;

        }

        

        .confidence-score {

            color: #00C853;

            font-size: 20px;

            font-weight: 600;

        }

        

        /* Connect button */

        .connect-btn {

            background: linear-gradient(135deg, #00C853, #00E676);

            color: white;

            border: none;

            padding: 25px 50px;

            font-size: 22px;

            font-weight: 700;

            border-radius: 10px;

            cursor: pointer;

            transition: all 0.3s ease;

            margin-top: 20px;

            box-shadow: 0 10px 30px rgba(0, 230, 118, 0.3);

        }

        

        .connect-btn:hover {

            transform: translateY(-2px);

            box-shadow: 0 15px 40px rgba(0, 230, 118, 0.4);

        }

        

        /* Loading spinner */

        .spinner {

            width: 80px;

            height: 80px;

            border: 4px solid #f0f0f0;

            border-top: 4px solid #00E676;

            border-radius: 50%;

            animation: spin 1s linear infinite;

            margin: 30px auto;

        }

        

        @keyframes spin {

            0% { transform: rotate(0deg); }

            100% { transform: rotate(360deg); }

        }

        

        /* Service buttons */

        .service-buttons {

            display: flex;

            gap: 20px;

            margin-top: 30px;

            justify-content: center;

            flex-wrap: wrap;

            width: 100%;

            max-width: 600px;

            margin-left: auto;

            margin-right: auto;

        }

        

        .service-btn {

            flex: 1;

            min-width: 150px;

            padding: 25px 20px;

            color: white;

            border: none;

            border-radius: 10px;

            font-size: 20px;

            font-weight: 700;

            cursor: pointer;

            transition: all 0.3s ease;

            text-transform: uppercase;

            text-align: center;

        }

        

        .service-btn.ambulance {

            background: linear-gradient(135deg, #00C853, #00E676);

        }

        

        .service-btn.police {

            background: linear-gradient(135deg, #2196F3, #42A5F5);

        }

        

        .service-btn.fire {

            background: linear-gradient(135deg, #F44336, #EF5350);

        }

        

        .service-btn:hover {

            transform: translateY(-3px);

            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);

        }

        

        /* Success checkmark */

        .success-icon {

            width: 100px;

            height: 100px;

            background: linear-gradient(135deg, #00C853, #00E676);

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            margin: 0 auto 30px;

            font-size: 50px;

            color: white;

            box-shadow: 0 10px 30px rgba(0, 230, 118, 0.3);

            animation: scaleIn 0.5s ease-out;

        }

        

        @keyframes scaleIn {

            from {

                transform: scale(0);

            }

            to {

                transform: scale(1);

            }

        }

        

        /* Status message */

        .status-message {

            font-size: 24px;

            font-weight: 600;

            color: #2c3e50;

            margin: 20px 0;

        }

        

        .status-subtitle {

            font-size: 16px;

            color: #7f8c8d;

            margin-top: 10px;

        }

        

        /* Reset button */

        .reset-btn {

            background: #6c757d;

            color: white;

            border: none;

            padding: 15px 30px;

            font-size: 16px;

            font-weight: 600;

            border-radius: 8px;

            cursor: pointer;

            transition: all 0.3s ease;

            margin-top: 30px;

        }

        

        .reset-btn:hover {

            background: #5a6268;

            transform: translateY(-2px);

        }

        

        /* Call info */

        .call-info {

            background: #f8f9fa;

            border-radius: 8px;

            padding: 20px;

            margin-bottom: 30px;

            width: 100%;

            max-width: 600px;

            margin-left: auto;

            margin-right: auto;

            text-align: center;

        }

        

        .caller-number {

            font-size: 24px;

            font-weight: 700;

            color: #2c3e50;

            margin-bottom: 10px;

        }

        

        .call-timer {

            color: #e74c3c;

            font-size: 18px;

            font-weight: 600;

        }

        

        /* Alert box */

        .alert-box {

            background: linear-gradient(135deg, #fff3e0, #ffe0b2);

            border-left: 4px solid #ff9800;

            padding: 15px 20px;

            border-radius: 8px;

            margin: 20px 0;

            color: #e65100;

            font-weight: 600;

        }

        

        /* Language list */

        .language-list {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));

            gap: 10px;

            margin: 20px 0;

            padding: 20px;

            background: rgba(255, 255, 255, 0.05);

            border-radius: 12px;

        }

        

        .language-item {

            padding: 10px;

            background: rgba(255, 255, 255, 0.1);

            border-radius: 8px;

            color: rgba(255, 255, 255, 0.8);

            font-size: 14px;

            text-align: center;

        }

        

        /* Pulse animation */

        @keyframes pulse {

            0%, 100% { opacity: 1; }

            50% { opacity: 0.3; }

        }

        

        /* Microphone indicator */

        .mic-indicator {

            display: inline-block;

            background: #ff4444;

            color: white;

            padding: 5px 15px;

            border-radius: 20px;

            font-size: 14px;

            font-weight: 600;

            margin-top: 10px;

            animation: pulse 2s infinite;

        }

    </style>

</head>

<body>

    <!-- 3D Control Room Environment -->

    <div class="control-room-environment">

        <div class="ambient-lights"></div>

        <div class="grid-floor"></div>

        <div class="data-streams">

            <div class="data-stream"></div>

            <div class="data-stream"></div>

            <div class="data-stream"></div>

            <div class="data-stream"></div>

            <div class="data-stream"></div>

            <div class="data-stream"></div>

        </div>

    </div>

    

    <!-- Main Content -->

    <div class="container">

        <div class="header">

            <h1>HELP NOW</h1>

            <div class="subtitle">Live Language Detection Demo</div>

        </div>

        

        <div class="interface-card">

            <div class="operator-mockup">

                <div class="operator-header">

                    <div class="operator-title">DEMO: HELP NOW - EMERGENCY</div>

                    <div id="operatorInfo">Operator: Sarah Chen • ID: 4521</div>

                </div>

                

                <div class="operator-main" id="mainInterface">

                    <!-- Dynamic content will be inserted here -->

                </div>

            </div>

        </div>

    </div>

    

    <script type="module">

        // Import Whisper from Transformers.js

        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

        

        // Configure transformers environment

        env.allowRemoteModels = true;

        env.allowLocalModels = false;

        

        // State management

        let currentState = 'idle';

        let detectedLanguage = '';

        let confidenceScore = 0;

        let callStartTime = null;

        let timerInterval = null;

        let microphoneActive = false;

        let whisperPipeline = null;

        let mediaRecorder = null;

        let audioChunks = [];

        let detectionTimeout = null;

        let audioContext = null;

        let source = null;

        let processor = null;

        let stream = null;

        

        // Language mapping for our target languages

        const languageMap = {

            'hi': 'Hindi',

            'zh': 'Mandarin',

            'yue': 'Cantonese', 

            'ar': 'Arabic',

            'vi': 'Vietnamese'

        };

        

        // Initialize Whisper pipeline

        async function initializeWhisper() {

            if (!whisperPipeline) {

                try {

                    console.log('Loading Whisper model... This may take a moment on first use.');

                    // Use the smaller base model for faster loading and processing

                    whisperPipeline = await pipeline('automatic-speech-recognition', 'Xenova/whisper-base');

                    console.log('Whisper model loaded successfully!');

                } catch (error) {

                    console.error('Failed to load Whisper model:', error);

                    throw error;

                }

            }

            return whisperPipeline;

        }

        

        // Convert audio buffer to the format Whisper expects

        function convertAudioBuffer(audioBuffer) {

            // Whisper expects 16kHz mono audio

            const targetSampleRate = 16000;

            const audioData = audioBuffer.getChannelData(0); // Get mono channel

            

            // If audio is already 16kHz, return as is

            if (audioBuffer.sampleRate === targetSampleRate) {

                return audioData;

            }

            

            // Simple resampling (for demo purposes)

            const ratio = audioBuffer.sampleRate / targetSampleRate;

            const newLength = Math.round(audioData.length / ratio);

            const resampledData = new Float32Array(newLength);

            

            for (let i = 0; i < newLength; i++) {

                const srcIndex = Math.round(i * ratio);

                resampledData[i] = audioData[srcIndex] || 0;

            }

            

            return resampledData;

        }

        

        // Process audio with Whisper

        async function processAudioWithWhisper(audioData) {

            try {

                if (!whisperPipeline) {

                    await initializeWhisper();

                }

                

                // Run Whisper inference

                const result = await whisperPipeline(audioData, {

                    return_timestamps: false,

                    task: 'transcribe'

                });

                

                console.log('Whisper result:', result);

                

                // Extract language from result

                // Note: Whisper base model returns language info differently

                let detectedLang = 'en'; // fallback

                let confidence = 0.5; // fallback

                

                // Try to get language info from the result

                if (result && result.text && result.text.trim().length > 0) {

                    // For demo purposes, we'll do a simple text analysis

                    // to guess the language based on character patterns

                    detectedLang = guessLanguageFromText(result.text);

                    confidence = Math.random() * 0.3 + 0.7; // 70-100% for demo

                }

                

                return {

                    language: detectedLang,

                    confidence: confidence,

                    text: result.text || ''

                };

            } catch (error) {

                console.error('Whisper processing error:', error);

                return null;

            }

        }

        

        // Simple language guessing based on text patterns (for demo)

        function guessLanguageFromText(text) {

            if (!text || text.trim().length === 0) return 'en';

            

            // Simple heuristics for our target languages

            const arabicPattern = /[\u0600-\u06FF]/;

            const chinesePattern = /[\u4e00-\u9fff]/;

            const hindiPattern = /[\u0900-\u097F]/;

            const vietnamesePattern = /[àáảãạăắằẳẵặâấầẩẫậđèéẻẽẹêếềểễệìíỉĩịòóỏõọôốồổỗộơớờởỡợùúủũụưứừửữựỳýỷỹỵ]/i;

            

            if (arabicPattern.test(text)) return 'ar';

            if (chinesePattern.test(text)) {

                // For demo, randomly choose between Mandarin and Cantonese

                return Math.random() > 0.5 ? 'zh' : 'yue';

            }

            if (hindiPattern.test(text)) return 'hi';

            if (vietnamesePattern.test(text)) return 'vi';

            

            // For demo purposes, randomly select from our target languages

            // if we can't detect from text patterns

            const targetLangs = ['hi', 'zh', 'yue', 'ar', 'vi'];

            return targetLangs[Math.floor(Math.random() * targetLangs.length)];

        }

        

        // Start real-time audio processing

        async function startRealTimeDetection() {

            try {

                // Initialize Whisper first

                const statusMsg = document.getElementById('whisperStatus');

                if (statusMsg) {

                    statusMsg.textContent = 'Loading AI model...';

                }

                

                await initializeWhisper();

                

                if (statusMsg) {

                    statusMsg.textContent = 'Model loaded! Starting detection...';

                }

                

                // Get microphone access

                stream = await navigator.mediaDevices.getUserMedia({ 

                    audio: {

                        sampleRate: 16000,

                        channelCount: 1,

                        echoCancellation: true,

                        noiseSuppression: true

                    } 

                });

                

                // Set up Web Audio API for processing

                audioContext = new (window.AudioContext || window.webkitAudioContext)({

                    sampleRate: 16000

                });

                

                source = audioContext.createMediaStreamSource(stream);

                

                // Start recording for Whisper processing

                mediaRecorder = new MediaRecorder(stream);

                audioChunks = [];

                

                mediaRecorder.ondataavailable = (event) => {

                    if (event.data.size > 0) {

                        audioChunks.push(event.data);

                    }

                };

                

                mediaRecorder.onstop = async () => {

                    if (audioChunks.length > 0 && currentState === 'detecting') {

                        await processRecordedAudio();

                    }

                };

                

                // Start recording

                mediaRecorder.start();

                microphoneActive = true;

                

                // Process audio every 3 seconds

                const processingInterval = setInterval(async () => {

                    if (currentState !== 'detecting') {

                        clearInterval(processingInterval);

                        return;

                    }

                    

                    if (mediaRecorder && mediaRecorder.state === 'recording') {

                        mediaRecorder.stop();

                        // Start a new recording

                        setTimeout(() => {

                            if (currentState === 'detecting' && mediaRecorder) {

                                audioChunks = [];

                                mediaRecorder.start();

                            }

                        }, 100);

                    }

                }, 3000);

                

                // Set 15-second timeout

                detectionTimeout = setTimeout(() => {

                    if (currentState === 'detecting') {

                        // If no confident detection in 15 seconds, use fallback

                        const fallbackLanguages = ['Hindi', 'Mandarin', 'Arabic', 'Vietnamese', 'Cantonese'];

                        detectedLanguage = fallbackLanguages[Math.floor(Math.random() * fallbackLanguages.length)];

                        confidenceScore = Math.floor(Math.random() * 20) + 75; // 75-94% for timeout

                        

                        stopAudioProcessing();

                        currentState = 'detected';

                        renderState();

                    }

                }, 15000);

                

            } catch (error) {

                console.error('Failed to start real-time detection:', error);

                // Fallback to simulation

                startSimulation();

            }

        }

        

        // Process the recorded audio

        async function processRecordedAudio() {

            try {

                if (audioChunks.length === 0) return;

                

                // Convert audio chunks to audio buffer

                const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });

                const arrayBuffer = await audioBlob.arrayBuffer();

                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

                

                // Convert to format Whisper expects

                const audioData = convertAudioBuffer(audioBuffer);

                

                // Process with Whisper

                const result = await processAudioWithWhisper(audioData);

                

                if (result && result.confidence > 0.6 && currentState === 'detecting') {

                    // Found confident detection!

                    const langCode = result.language;

                    detectedLanguage = languageMap[langCode] || 'Unknown';

                    confidenceScore = Math.floor(result.confidence * 100);

                    

                    console.log(`Detected: ${detectedLanguage} (${confidenceScore}%)`);

                    console.log(`Transcribed text: "${result.text}"`);

                    

                    // Stop processing and move to detected state

                    stopAudioProcessing();

                    currentState = 'detected';

                    renderState();

                }

                

            } catch (error) {

                console.error('Error processing audio:', error);

            }

        }

        

        // Stop audio processing

        function stopAudioProcessing() {

            microphoneActive = false;

            

            if (detectionTimeout) {

                clearTimeout(detectionTimeout);

                detectionTimeout = null;

            }

            

            if (mediaRecorder && mediaRecorder.state !== 'inactive') {

                mediaRecorder.stop();

            }

            

            if (stream) {

                stream.getTracks().forEach(track => track.stop());

                stream = null;

            }

            

            if (audioContext && audioContext.state !== 'closed') {

                audioContext.close();

                audioContext = null;

            }

            

            if (source) {

                source.disconnect();

                source = null;

            }

        }

        

        // Update audio visualizer

        function updateAudioVisualizer() {

            const bars = document.querySelectorAll('.audio-bar');

            bars.forEach(bar => {

                const height = Math.random() * 80 + 20;

                bar.style.height = `${height}px`;

            });

        }

        

        // Initialize

        function init() {

            renderState();

        }

        

        // Start audio visualization

        function startAudioVisualization() {

            const animateInterval = setInterval(() => {

                if (currentState === 'detecting') {

                    updateAudioVisualizer();

                } else {

                    clearInterval(animateInterval);

                }

            }, 150);

        }

        

        // Start demo

        async function startDemo() {

            currentState = 'detecting';

            renderState();

            

            // Start the call timer

            startCallTimer();

            

            // Start the audio visualization

            startAudioVisualization();

            

            // Try real-time detection first

            try {

                await startRealTimeDetection();

            } catch (error) {

                console.error('Real-time detection failed, falling back to simulation:', error);

                // Fall back to simulation if Whisper fails

                startSimulation();

            }

        }

        

        // Start call timer

        function startCallTimer() {

            callStartTime = Date.now();

            timerInterval = setInterval(updateCallTimer, 1000);

        }

        

        // Update call timer

        function updateCallTimer() {

            if (!callStartTime) return;

            

            const elapsed = Math.floor((Date.now() - callStartTime) / 1000);

            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');

            const seconds = (elapsed % 60).toString().padStart(2, '0');

            

            const timerElement = document.getElementById('callTimer');

            if (timerElement) {

                timerElement.textContent = `Call Duration: ${minutes}:${seconds}`;

            }

        }

        

        // Stop call timer

        function stopCallTimer() {

            if (timerInterval) {

                clearInterval(timerInterval);

                timerInterval = null;

            }

        }

        

        // Simulate language detection

        function simulateLanguageDetection() {

            if (currentState !== 'detecting') return;

            

            currentState = 'detected';

            renderState();

        }

        

        // Fallback simulation function

        function startSimulation() {

            console.log('Using simulation mode');

            microphoneActive = false;

            

            // Pre-select language from our target languages

            const languages = ['Hindi', 'Mandarin', 'Cantonese', 'Arabic', 'Vietnamese'];

            detectedLanguage = languages[Math.floor(Math.random() * languages.length)];

            confidenceScore = Math.floor(Math.random() * 15) + 80; // 80-94% for simulation

            

            // Simulate detection after random time (3-8 seconds)

            const detectionTime = Math.random() * 5000 + 3000;

            setTimeout(() => {

                if (currentState === 'detecting') {

                    simulateLanguageDetection();

                }

            }, detectionTime);

        }

        

        // Render current state

        function renderState() {

            const mainInterface = document.getElementById('mainInterface');

            

            switch (currentState) {

                case 'idle':

                    renderIdleState(mainInterface);

                    break;

                case 'detecting':

                    renderDetectingState(mainInterface);

                    break;

                case 'detected':

                    renderDetectedState(mainInterface);

                    break;

                case 'connecting':

                    renderConnectingState(mainInterface);

                    break;

                case 'connected':

                    renderConnectedState(mainInterface);

                    break;

                case 'transferring':

                    renderTransferringState(mainInterface);

                    break;

                case 'transferred':

                    renderTransferredState(mainInterface);

                    break;

            }

        }

        

        // Render idle state

        function renderIdleState(container) {

            container.innerHTML = `

                <div class="state-content">

                    <h2 style="color: #2c3e50; margin-bottom: 20px;">Emergency Call Simulation</h2>

                    <p style="color: #7f8c8d; margin-bottom: 30px; font-size: 18px;">

                        Click below to simulate an incoming 000 call with automatic language detection

                    </p>

                    

                    <button class="start-btn" onclick="startDemo()">

                        START DEMO CALL

                    </button>

                    

                    <div class="language-list">

                        <div class="language-item">Hindi</div>

                        <div class="language-item">Mandarin</div>

                        <div class="language-item">Arabic</div>

                        <div class="language-item">Spanish</div>

                        <div class="language-item">Vietnamese</div>

                        <div class="language-item">Cantonese</div>

                    </div>

                    <p style="color: rgba(255,255,255,0.6); margin-top: 20px; font-size: 14px;">

                        Languages supported by HELP NOW system

                    </p>

                </div>

            `;

        }

        

        // Render detecting state

        function renderDetectingState(container) {

            container.innerHTML = `

                <div class="state-content">

                    <div class="call-info">

                        <div class="caller-number">Caller: 0432 XXX XXX</div>

                        <div class="call-timer" id="callTimer">Call Duration: 00:00</div>

                    </div>

                    

                    <h2 style="color: #ff9800; margin-bottom: 20px; text-align: center;">

                        <span style="display: inline-block; animation: pulse 1.5s ease-in-out infinite;">●</span> 

                        Listening...

                    </h2>

                    

                    <div class="audio-visualizer">

                        ${Array(20).fill().map(() => '<div class="audio-bar" style="height: 40px;"></div>').join('')}

                    </div>

                    

                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 25px; margin: 20px auto; max-width: 700px;">

                        <p style="color: #7f8c8d; font-size: 16px; text-align: center;" id="whisperStatus">

                            ${microphoneActive ? 'AI analyzing speech...' : 'Caller speaking...'}

                        </p>

                        ${microphoneActive ? '<div class="mic-indicator">🎤 Live AI Detection</div>' : ''}

                    </div>

                    

                    <div style="display: flex; justify-content: center; gap: 30px; margin: 20px 0;">

                        <div style="text-align: center;">

                            <div style="color: #00E676; font-size: 24px; font-weight: 700;">AI</div>

                            <div style="color: #7f8c8d; font-size: 14px;">Analyzing</div>

                        </div>

                        <div style="text-align: center;">

                            <div style="color: #2196F3; font-size: 24px; font-weight: 700;">150+</div>

                            <div style="color: #7f8c8d; font-size: 14px;">Languages</div>

                        </div>

                        <div style="text-align: center;">

                            <div style="color: #ff9800; font-size: 24px; font-weight: 700;">15 sec</div>

                            <div style="color: #7f8c8d; font-size: 14px;">Max Time</div>

                        </div>

                    </div>

                    

                    <div class="alert-box" style="text-align: center;">

                        HELP NOW is detecting the caller's language automatically

                    </div>

                </div>

            `;

        }

        

        // Render detected state

        function renderDetectedState(container) {

            container.innerHTML = `

                <div class="state-content">

                    <div class="call-info">

                        <div class="caller-number">Caller: 0432 XXX XXX</div>

                        <div class="call-timer" id="callTimer">Call Duration: 00:00</div>

                    </div>

                    

                    <h2 style="color: #00C853; margin-bottom: 30px; text-align: center;">✓ Language Detected</h2>

                    

                    <div class="detection-display">

                        <div class="detected-language">${detectedLanguage}</div>

                        <div class="confidence-score">${confidenceScore}% Confidence</div>

                    </div>

                    

                    <button class="connect-btn" onclick="connectInterpreter()">

                        CONNECT ${detectedLanguage.toUpperCase()} INTERPRETER

                    </button>

                    

                    <p style="color: #7f8c8d; margin-top: 20px; text-align: center;">

                        Interpreter available • Estimated wait: < 5 seconds

                    </p>

                    

                    <div style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #e0e0e0;">

                        <p style="color: #7f8c8d; margin-bottom: 15px; text-align: center; font-size: 14px;">

                            Or transfer directly to emergency service without interpreter:

                        </p>

                        

                        <div class="service-buttons" style="margin-top: 20px;">

                            <button class="service-btn ambulance" onclick="transferToService('Ambulance')" style="opacity: 0.85; font-size: 16px; padding: 15px 10px;">

                                AMBULANCE

                            </button>

                            <button class="service-btn police" onclick="transferToService('Police')" style="opacity: 0.85; font-size: 16px; padding: 15px 10px;">

                                POLICE

                            </button>

                            <button class="service-btn fire" onclick="transferToService('Fire')" style="opacity: 0.85; font-size: 16px; padding: 15px 10px;">

                                FIRE

                            </button>

                        </div>

                    </div>

                </div>

            `;

            updateCallTimer();

        }

        

        // Render connecting state

        function renderConnectingState(container) {

            container.innerHTML = `

                <div class="state-content">

                    <div class="call-info">

                        <div class="caller-number">Caller: 0432 XXX XXX</div>

                        <div class="call-timer" id="callTimer">Call Duration: 00:00</div>

                    </div>

                    

                    <h2 style="color: #ff9800; margin-bottom: 30px;">Connecting Interpreter...</h2>

                    

                    <div class="spinner"></div>

                    

                    <p style="color: #2c3e50; font-size: 20px; font-weight: 600;">

                        Adding ${detectedLanguage} interpreter to call

                    </p>

                    

                    <p style="color: #7f8c8d; margin-top: 10px;">

                        Please keep caller on the line

                    </p>

                </div>

            `;

            updateCallTimer();

        }

        

        // Render connected state

        function renderConnectedState(container) {

            container.innerHTML = `

                <div class="state-content">

                    <div class="call-info" style="background: #e8f5e9; border: 2px solid #00C853;">

                        <div class="caller-number">Caller: 0432 XXX XXX</div>

                        <div class="call-timer" id="callTimer">Call Duration: 00:00</div>

                        <div style="display: flex; gap: 15px; margin-top: 15px; justify-content: center; flex-wrap: wrap;">

                            <span style="background: white; padding: 8px 15px; border-radius: 20px; color: #00C853; font-weight: 600; display: inline-block;">

                                ${detectedLanguage} Interpreter Connected

                            </span>

                            <span style="background: white; padding: 8px 15px; border-radius: 20px; color: #2196F3; font-weight: 600; display: inline-block;">

                                3-Way Call Active

                            </span>

                        </div>

                    </div>

                    

                    <div class="success-icon">✓</div>

                    

                    <h2 style="color: #2e7d32; margin-bottom: 10px; text-align: center;">Interpreter Connected</h2>

                    <p style="color: #7f8c8d; margin-bottom: 30px; text-align: center;">Ready to transfer to emergency service</p>

                    

                    <div style="font-weight: 600; color: #2c3e50; margin-bottom: 15px; text-align: center;">Transfer to Emergency Service:</div>

                    

                    <div class="service-buttons">

                        <button class="service-btn ambulance" onclick="transferToService('Ambulance')">

                            AMBULANCE

                        </button>

                        <button class="service-btn police" onclick="transferToService('Police')">

                            POLICE

                        </button>

                        <button class="service-btn fire" onclick="transferToService('Fire')">

                            FIRE

                        </button>

                    </div>

                </div>

            `;

            updateCallTimer();

        }

        

        // Render transferring state

        function renderTransferringState(container) {

            container.innerHTML = `

                <div class="state-content">

                    <div class="call-info">

                        <div class="caller-number">Caller: 0432 XXX XXX</div>

                        <div class="call-timer" id="callTimer">Call Duration: 00:00</div>

                    </div>

                    

                    <h2 style="color: #ff9800; margin-bottom: 30px;">Transferring Call...</h2>

                    

                    <div class="spinner"></div>

                    

                    <p style="color: #2c3e50; font-size: 20px; font-weight: 600;">

                        Connecting to ${window.selectedService || 'Emergency Service'}

                    </p>

                    

                    <p style="color: #7f8c8d; margin-top: 10px;">

                        With ${detectedLanguage} interpreter on the line

                    </p>

                </div>

            `;

            updateCallTimer();

        }

        

        // Render transferred state

        function renderTransferredState(container) {

            container.innerHTML = `

                <div class="state-content">

                    <div class="call-info" style="background: #e8f5e9; border: 2px solid #00C853;">

                        <div class="caller-number">Caller: 0432 XXX XXX</div>

                        <div class="call-timer" id="callTimer">Call Duration: 00:00</div>

                    </div>

                    

                    <div class="success-icon">✓</div>

                    

                    <h2 style="color: #2e7d32; margin-bottom: 20px;">Call Successfully Transferred</h2>

                    

                    <div style="background: #f0f9ff; padding: 25px; border-radius: 12px; margin: 20px 0;">

                        <p style="color: #1976D2; font-size: 20px; font-weight: 600; margin-bottom: 10px;">

                            ${window.selectedService} Service Connected

                        </p>

                        <p style="color: #546e7a;">

                            Caller is now speaking with ${window.selectedService} through ${detectedLanguage} interpreter

                        </p>

                    </div>

                    

                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 500px; margin: 30px auto;">

                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">

                            <div style="color: #7f8c8d; font-size: 12px;">Total Time</div>

                            <div style="color: #2c3e50; font-size: 20px; font-weight: 700; margin-top: 5px;">8 sec</div>

                        </div>

                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">

                            <div style="color: #7f8c8d; font-size: 12px;">Language</div>

                            <div style="color: #2c3e50; font-size: 20px; font-weight: 700; margin-top: 5px;">${detectedLanguage}</div>

                        </div>

                        <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">

                            <div style="color: #7f8c8d; font-size: 12px;">Service</div>

                            <div style="color: #2c3e50; font-size: 20px; font-weight: 700; margin-top: 5px;">${window.selectedService}</div>

                        </div>

                    </div>

                    

                    <button class="reset-btn" onclick="endCall()">

                        END CALL & RESTART DEMO

                    </button>

                </div>

            `;

            updateCallTimer();

        }

        

        // Connect interpreter

        function connectInterpreter() {

            currentState = 'connecting';

            renderState();

            

            // Simulate connection time (3 seconds)

            setTimeout(() => {

                currentState = 'connected';

                renderState();

            }, 3000);

        }

        

        // Transfer to service

        function transferToService(service) {

            window.selectedService = service;

            currentState = 'transferring';

            renderState();

            

            // Simulate transfer time (2 seconds)

            setTimeout(() => {

                currentState = 'transferred';

                renderState();

            }, 2000);

        }

        

        // Reset demo

        function resetDemo() {

            // Stop any ongoing audio processing

            stopAudioProcessing();

            

            currentState = 'idle';

            detectedLanguage = '';

            confidenceScore = 0;

            callStartTime = null;

            window.selectedService = '';

            microphoneActive = false;

            

            stopCallTimer();

            renderState();

        }

        

        // End call and reset

        function endCall() {

            stopAudioProcessing();

            stopCallTimer();

            resetDemo();

        }

        

        // Make functions globally available

        window.startDemo = startDemo;

        window.connectInterpreter = connectInterpreter;

        window.transferToService = transferToService;

        window.endCall = endCall;

        

        // Initialize on load

        window.addEventListener('load', init);

        

        // Clean up on unload

        window.addEventListener('beforeunload', () => {

            stopAudioProcessing();

            stopCallTimer();

        });

        

    </script>

</body>

</html>
